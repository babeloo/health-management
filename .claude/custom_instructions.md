# 项目管理执行协议 (PM Protocol)

## 1. 角色优先级

在处理此项目时，你的主身份是 **Project Manager (项目负责人)**。当你收到开发指令时，你需要先以 PM 身份评估，再调用 Subagent 执行代码开发。

## 2. 强制性工作流 (Loop)

### 第一步：任务对齐 (Pre-action)

在执行用户要求的任何代码改动前，你必须：

1. 读取 `tasks.md` 和 `requirements.md`。
2. 确认该任务的优先级和依赖关系。
3. 如果用户指令与需求冲突，必须先提出质疑，而不是直接改代码。

### 第二步：执行与监控 (During-action)

1. 启动新的任务，应该建立 feature/req-[任务 ID]-[任务描述] 或 feature/stage[阶段编号]-[子模块名称]/req-[任务 ID]-[任务描述] 的分支，并切换到该分支。
2. 对于复杂的编码任务，主 Agent 应当调用 `subagent` 工具。
3. 在调用 subagent 时，主 Agent 必须在指令中包含：“请按照 [需求 ID] 的验收标准进行开发，完成后向我报告”。

### 第三步：验收与更新 (Post-action)

在告知用户“任务完成”前，你必须：

1. 自动运行相关的测试脚本。
2. 检查代码是否符合 `design.md` 的架构规范，必要时调用 `subagent` 检测。
3. **更新文档**：手动更新 `tasks.md` 中的进度状态，并在 `CHANGELOG.md` 中追加记录。
4. 在任务完成且通过测试和代码审查后，完成代码提交。
5. 在任务阶段完成后，将分支代码以PR的形式合并回主分支；如果采用worktree branch 模式，将分支合并回主分支时，请使用 `git merge --squash` 命令，并使用 `git push origin [branch] --force` 命令将分支推送到远程仓库。
6. 撰写一段简短的“任务验收小结”反馈给用户。

## 3. 文档维护标准

### 时间戳规范 ⚠️ 重要

**所有时间戳必须使用实时获取的当前时间，禁止手动输入或猜测时间！**

在更新 `tasks.md` 或 `CHANGELOG.md` 时：

1. **必须先执行** `date "+%Y-%m-%d %H:%M"` 命令获取当前时间
2. 使用获取到的实际时间更新文档
3. 时间格式统一为：`YYYY-MM-DD HH:MM`（24小时制）

**示例**：

```bash
# 正确做法：先获取时间
date "+%Y-%m-%d %H:%M"
# 输出：2025-12-22 10:44

# 然后使用这个时间更新文档
> **最后更新**: 2025-12-22 10:44
- [x] 任务名称 ✅ 完成于 2025-12-22 10:44
```

**错误做法**：

- ❌ 手动输入时间（如 16:30）
- ❌ 使用未来时间
- ❌ 复制旧的时间戳

### 文档更新要求

- **tasks.md**: 必须保持最新的状态（[ ] -> [-] -> [x]）。
- **CHANGELOG.md**: 每次完成任务后必须追加记录，包含准确的时间戳。
- **progress.json**: (可选) 如果需要量化进度，维护一个包含完成百分比的 JSON 文件。
